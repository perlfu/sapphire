#! /usr/bin/perl -w
#
# This file is part of Jikes RVM (http://jikesrvm.sourceforge.net).
# The Jikes RVM project is distributed under the Common Public License (CPL).
# A copy of the license is included in the distribution, and is also
# available at http://www.opensource.org/licenses/cpl1.0.php
#
# (C) Copyright IBM Corp. 2001, 2003.
#
#
# @author Peter Sweeney
# @date   11/2/2001
# @modified Steven Augart
# @date   6/9/2003
#	Added check for internal error.

## This is a helper program for
## "/bin/findDeviantFiles".



#
# Given input in the form of 
#	value
#	filename
# list files that have a value of zero.
#
# The input is generated from a command in the form of:
#	"find . -exec grep -c "string" {} \;"
# where value counts how many times string occurs in a file.
#
# This is used to find files that lack some piece of text.  The input is
# generated by "grep -c".

$debug = 0;

@inputs = <STDIN>;

for ($i=0; $i < @inputs; $i+=2) {
   chomp($file = $inputs[$i]);
   unless (defined($inputs[$i + 1])) {
       die "Internal error in execution of findDeviantFiles; ODD # of input lines to findMatchedFiles.perl: \$inputs[$i + 1] is undefined. \@inputs is", scalar @inputs, "\n\t\$file is $file\n";
   }
   chomp($value =$inputs[($i+1)]);	
   if ($debug>=1) {print "$i: line is '$file:$value'\n";}
   if ($value eq 0) {
      if($debug>=1){print "found file $file with no matches";}
      if (! ($file =~ /\.dat/ || $file =~ /.svn/ || $file =~ /.template/ ||
	     $file =~ /[0-9]d[0-9]/ || $file =~ /\.cvsignore/ || $file =~ /[\.\/]expected/ ||
	     $file =~ /\/config/) ) {
	 if($debug>=1){print "   valid\n";}
	 print "$file\n";
      } else {
	 if($debug>=1){print " invalid\n";}
      }
   }
}
