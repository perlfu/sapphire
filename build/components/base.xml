<project name="base-components">

  <property name="jikesrvm.dir" location="${basedir}/../../"/>
  <import file="${jikesrvm.dir}/build/base.xml"/>
  <import file="${jikesrvm.dir}/build/tasks.xml"/>

  <property file="${target.file}"/>

  <macrodef name="setupComponentsConfig">
    <text name="props"/>
    <sequential>
      <if>
        <conditions>
          <isset property="protect.config-files"/>
        </conditions>
        <sequential>
          <echo><![CDATA[Edit the components configuration file ${components.file} and add the following lines(s):${line.separator}@{props}]]></echo>
        </sequential>
      </if>
      <if>
        <conditions>
          <not>
            <isset property="protect.config-files"/>
          </not>
        </conditions>
        <sequential>
          <echo file="${components.file}" append="true"><![CDATA[@{props}]]></echo>
        </sequential>
      </if>
    </sequential>
  </macrodef>
  <macrodef name="ensureUptodate">
    <attribute name="name"/>
    <attribute name="dir"/>
    <sequential>
      <property file="@{dir}/constants.properties" prefix="ensure."/>
      <condition property="ensure.valid" value="true" else="false">
        <and>
          <available file="@{dir}/constants.properties"/>
          <equals arg1="${ensure.@{name}.version}" arg2="${@{name}.version}"/>
        </and>
      </condition>
      <if>
        <conditions>
          <equals arg1="${ensure.valid}" arg2="false"/>
        </conditions>
        <sequential>
        <echo message="@{name} does not exist or is of the wrong version. Rebuilding..."/>
          <antcall target="build" inheritall="false" inheritrefs="false"/>
        </sequential>
      </if>
    </sequential>
  </macrodef>

</project>
