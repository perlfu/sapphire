<project name="ecj" default="build" basedir=".">

  <import file="base.xml"/>

  <property name="ecj.version" value="3.2"/>

  <!-- **************************************************************************** -->
  <!-- *                                                                          * -->
  <!-- *               Downloading and installing Eclipse compiler                * -->
  <!-- *                                                                          * -->
  <!-- **************************************************************************** -->

  <target name="init-ecj-properties" depends="prepare-ant-tasks">
    <property name="ecj.dir" location="${components.dir}/ecj/${ecj.version}/ecj-${ecj.version}"/>
    <condition property="ecj.from-web" value="true">
      <or>
        <not>
          <available file="${ecj.dir}/ecj.jar"/>
        </not>
        <isset property="ecj.force-download"/>
      </or>
    </condition>
  </target>

  <target name="fetch" depends="init-ecj-properties" if="ecj.from-web">
    <mkdir dir="${ecj.dir}"/>
    <get src="http://download.eclipse.org/eclipse/downloads/drops/R-3.2-200606291905/ecj.jar"
         dest="${ecj.dir}/ecj.jar"/>
    <echo file="${ecj.dir}/ecj">#!/bin/bash
java -Xmx256m -jar "`dirname "$0"`/ecj.jar" -warn:-unusedPrivate "$@"
    </echo>
    <chmod file="${ecj.dir}/ecj" perm="ugo+rx"/>
    <echo file="${ecj.dir}/constants.properties"><![CDATA[
ecj.version=${ecj.version}
ecj.description=Eclipse Compiler
]]></echo>
  </target>

  <target name="build" depends="fetch">
    <setComponentsConfig key="ecj.dir" value="${ecj.dir}"/>
  </target>

  <target name="ensure" depends="init-ecj-properties">
    <ensureUptodate name="ecj" dir="${ecj.dir}"/>
  </target>

</project>
