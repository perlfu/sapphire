<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>RVM : Life Cycle of a Compiled Method</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="page">
            <div id="main">
                <div id="main-header" class="pageSectionHeader">
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            RVM : Life Cycle of a Compiled Method
                        </span>
                    </h1>

                    <div class="page-metadata">
                        <p>This page last changed on Jul 07, 2008 by <font color="#0050B2">dgrove</font>.</p>
                    </div>
                </div>

                <div id="content" class="view">
                    <div id="main-content" class="wiki-content group">
                    <p>In early implementations of Jikes RVM's adaptive system, compilation required holding a global lock that serialized compilation and also prevented classloading from occurring concurrently with compilation.  This bottleneck was removed in version 2.1.0 by switching to a finer-grained locking discipline to coordinate compilation, speculative optimization, and class loading. Since no published description of this locking protocol exists outside of the source code, we briefly summarize the life cycle of a compiled method here.</p>

<p>When Jikes RVM compiles a method, it creates a compiled method object to represent this particular compilation of the source method.  A compiled method has a unique id, and stores the compiled code and associated compiler meta-data. After a brief initialization phase, the compiled method transitions from <em>uncompiled</em> to <em>compiling</em> when compilation begins. During compilation, the optimizing compiler may perform speculative optimizations that can be invalidated by future class loading.  Each time the compiler so speculates, it records a relevant entry in an invalidation database.  Upon finishing compilation, the system checks to ensure that the current compilation has not already been  invalidated by concurrent classloading.  If it has not, then the system installs the compiled code, and subsequent  invocations will branch to the newly created code.</p>

<p>Each time a class is loaded, the system checks the invalidation database to identify the set of compiled methods to mark as obsolete,<br />
because this classloading action invalidates speculative optimizations previously applied to that method.  A method may transition from either <em>compiling</em> or <em>installed</em> to <em>obsolete</em> due to a classloading-induced invalidation.  A method can also transition from <em>installed</em> to <em>obsolete</em> when the adaptive system selects a method for optimizing recompilation and a new compiled method is installed to replace it.</p>

<p>Once a method is marked obsolete, it will never be invoked again.  However, before the generated code for the compiled method can be garbage collected, all existing invocations of the compiled method must be complete.  A compiled method transitions from <em>obsolete</em> to  <em>dead</em> when no invocations of it exist on any thread stack.  Jikes RVM detects this as part of the stack scanning phase of garbage collection; as stack frames are scanned, their compiled methods are marked as active.  Any <em>obsolete</em> method that is not marked as active when stack scanning completes is marked as <em>dead</em> and the reference to it is removed from the compiled method table.  It will then be freed during the next garbage collection.  </p>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/93093975/93224965.eps">compiledMethod.eps</a> (image/x-eps)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" style="background: url(http://docs.codehaus.org/images/border/border_bottom.gif) repeat-x;">
                <p><small>Document generated by Confluence on Feb 12, 2013 09:32</small></p>
            </div>
        </div>     </body>
</html>
